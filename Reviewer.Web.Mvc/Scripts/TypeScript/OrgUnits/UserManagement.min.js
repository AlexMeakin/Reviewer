var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},ViewModels;(function(n){var t=function(n){function t(){n.call(this),this.IsLoading=ko.observable(!1),this.AssociateUsername=ko.observable(""),this.AssociateOrgUnitName=ko.observable(""),this.AssociateBusinessUnitName=ko.observable(""),this.AssociateMode=ko.observable(""),this.AssociatedUsers=ko.observableArray(),this.AvailableBusinessUnits=ko.observableArray(),this.FilterUsername=ko.observable(""),this.FilterOrgUnit=ko.observable("")}return __extends(t,n),t.prototype.Populate=function(n){var t=this;this.AssociatedUsers(jQuery.map(n.AssociatedUsers,function(n){return{IsLoading:ko.observable(!1),Username:n.Username,Role:n.Role,OrgUnits:ko.observableArray(n.OrgUnits),RemoveAssociation:t.RemoveAssociation}})),this.AvailableBusinessUnits(n.AvailableBusinessUnits)},t.prototype.RemoveAssociation=function(n,t){n.IsLoading(!0);var i={username:n.Username,orgUnit:t.OrganizationalUnit};$.post(this.RemoveUserFromOrgUnitUri,i,function(){n.OrgUnits.remove(t),n.IsLoading(!1)},"JSON")},t.prototype.AddAssociation=function(){var i=this,r=this.AssociateUsername(),u=this.AssociateMode(),t,n,f;switch(u){case"BusinessUnit":t=this.AssociateBusinessUnitName();break;case"OrganisationalUnit":t=this.AssociateOrgUnitName();break;default:alert("You must select a mode to create an association in.");return}if(t==null||t==""){alert("You must select an Organisational Unit");return}if(n=Enumerable.From(this.AssociatedUsers()).FirstOrDefault(null,function(n){return n.Username==r}),n){if(Enumerable.From(n.OrgUnits()).Any(function(n){return n.OrganizationalUnit==t})){alert("This user is already associated to the Organizational Unit '"+t+"'.");return}n.IsLoading(!0)}this.IsLoading(!0),f={username:r,orgUnit:t,mode:u},$.post(this.AddUserToOrgUnitUri,f,function(f){f.Success?(n==null&&(n={Username:r,Role:f.Role,OrgUnits:ko.observableArray(),RemoveAssociation:i.RemoveAssociation,IsLoading:ko.observable(!0)},i.AssociatedUsers.push(n)),n.OrgUnits.push({OrganizationalUnit:t,Mode:u,CreatedBy:f.CreatedBy,CreatedDate:f.CreatedDate})):alert(f.Message),n&&n.IsLoading(!1),i.IsLoading(!1)},"JSON")},t.prototype.GetModeName=function(n){switch(n){case"BusinessUnit":return"Business Unit";case"OrganisationalUnit":return"Organisational Unit";default:return"Unknown"}},t.prototype.OnOrgUnitSelected=function(n){this.AssociateOrgUnitName(n.Name)},t.prototype.cb_OnOrgUnitSelected=function(n){this.OnOrgUnitSelected(n)},t}(HasCallbacks);n.OrgUserManagementViewModel=t})(ViewModels||(ViewModels={}))