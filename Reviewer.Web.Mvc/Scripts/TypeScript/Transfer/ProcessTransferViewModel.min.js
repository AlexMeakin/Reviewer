var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r},ViewModels;(function(n){var t=function(n){function t(t,i){var r=this;n.call(this),this.ProcessTransferUri=t,this.Element=i,this.ActiveRequests=ko.observable(0),this.IsLoading=ko.computed(function(){return r.ActiveRequests()!=0}),this.IsCostCentre=ko.observable(!0),this.ApproveReject=ko.observable(""),this.ApproveRejectList=ko.observableArray(["Approve","Reject"]),this.RejectionReason=ko.observable(""),this.EffectiveFromDate=ko.observable(""),this.CostCentre=ko.observable(""),this.RecoveryCostCentre=ko.observable(""),this.BusinessArea=ko.observable(""),this.OrganisationalUnit=ko.observable(""),this.Level2=ko.observable(""),this.TransferReason=ko.observable(""),this.ResourceId=0,this.LineManagerFirstName=ko.observable(""),this.LineManagerLastName=ko.observable(""),this.LineManagerNavigatorId=ko.observable(""),this.CanProcess=ko.computed(this.cb_ComputeCanProcess),this.SelectedOrgUnit=ko.observable(""),this.CanAddOrgUnit=ko.computed(function(){return r.SelectedOrgUnit()!=""}),this.CostCentre.subscribe(this.cb_ValidateCostCentre)}return __extends(t,n),t.prototype.Setup=function(n){this.Transfer=n,this.EffectiveFromDate(moment(n.EffectiveFromDate).format("DD/MM/YYYY hh:mm:ss")),this.OrganisationalUnit(n.SenderOU),this.TransferReason(n.ReasonForTransfer),this.ResourceId=n.ResourceId,this.GetRecord(n.ResourceId),this.ApproveReject(""),this.SelectedOrgUnit(n.ReceiverOU),window.OrgUnitDrillDownViewModel.SelectOrgUnit(n.ReceiverOU),this.RejectionReason("")},t.prototype.GetRecord=function(n){var t=this,i={resourceId:n,vacancyId:null};this.StartRequest(),$.ajax({type:"POST",url:"/wfpmvc/Record/GetRecord",data:i,dataType:"json",traditional:!0,success:function(n){t.BusinessArea(n.BusinessArea),t.Level2(n.Level2),t.CostCentre(n.CostCentre),t.LineManagerFirstName(n.LineManagerFirstName),t.LineManagerLastName(n.LineManagerLastName),t.LineManagerNavigatorId(n.LineManagerNavigatorId),t.GetRecoveryCostCentre(),t.EndRequest()}})},t.prototype.ValidateCostCentre=function(){this.CostCentre()!=null&&(this.CostCentre().match(/^[0-9-]+$/)!=null?this.CostCentre().length<4?this.IsCostCentre(!1):this.IsCostCentre(!0):this.IsCostCentre(!1))},t.prototype.cb_ValidateCostCentre=function(){this.ValidateCostCentre()},t.prototype.GetRecoveryCostCentre=function(){var n=this,t;this.IsCostCentre(!0),this.RecoveryCostCentre(""),this.IsCostCentre()!=!1&&(t={costCentre:this.CostCentre()},this.StartRequest(),$.ajax({type:"POST",url:"/wfpmvc/CostCentreMappings/GetRecoveryCostCentre",data:t,dataType:"json",traditional:!0,success:function(t){n.RecoveryCostCentre(t.RecoveryCostCentre),n.EndRequest()}})),this.ValidateCostCentre()},t.prototype.ComputeCanProcess=function(){return this.IsLoading.peek()==!0?!1:this.ApproveReject()==""?!1:this.SelectedOrgUnit()==""?!1:this.RejectionReason()==""&&this.ApproveReject()=="Reject"?!1:!0},t.prototype.cb_ComputeCanProcess=function(){return this.ComputeCanProcess()},t.prototype.Process=function(){var n=this,t={IsApproved:this.ApproveReject()=="Approve",RejectionReason:this.RejectionReason(),TargetOrganizationalUnit:this.SelectedOrgUnit(),TransferId:this.Transfer.TransferId,EffectiveFromDate:this.EffectiveFromDate(),ReasonForTransfer:this.TransferReason()};this.StartRequest(),$.ajax({type:"POST",url:this.ProcessTransferUri,data:t,dataType:"json",traditional:!0,success:function(){n.EndRequest(),n.Close(),n.OnProcess!=null&&n.OnProcess(),alert("Transfer has been processed.")}})},t.prototype.UpdateResource=function(){var n=this,t={resourceId:this.ResourceId,value:this.CostCentre};$.ajax({type:"POST",url:"/wfpmvc/Resource/UpdateResource",data:t,dataType:"json",traditional:!0,success:function(t){t.Success==!0?n.Process():alert("Transfer not completed!")}})},t.prototype.cb_UpdateResource=function(){this.UpdateResource()},t.prototype.OnOrgUnitSelected=function(n){this.SelectedOrgUnit(n.Name)},t.prototype.cb_OnOrgUnitSelected=function(n){this.OnOrgUnitSelected(n)},t.prototype.cb_Process=function(){this.Process()},t.prototype.Close=function(){$(this.Element).modal("hide")},t.prototype.cb_Close=function(){this.Close()},t.prototype.StartRequest=function(){this.ActiveRequests(this.ActiveRequests()+1)},t.prototype.EndRequest=function(){this.ActiveRequests(this.ActiveRequests()-1)},t}(HasCallbacks);n.ProcessTransferViewModel=t})(ViewModels||(ViewModels={}))